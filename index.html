<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Redirecting...</title>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const hasAuthCode = urlParams.has("code");

    if (!hasAuthCode) {
      window.location.href =
        "https://eu-north-1ztktij4h.auth.eu-north-1.amazoncognito.com/login?client_id=4612i0a2sa5qdv7d0h67fht6ol&response_type=code&scope=email+openid&redirect_uri=https://lujainmurad.github.io/peerreview-cloud-frontend/";
    }
  </script>
</head>
<body style="font-family: sans-serif; padding: 2em;">
  <h2>Upload File</h2>
  <input type="file" id="fileInput" />
  <button onclick="uploadFile()">Upload</button>
  <p id="uploadStatus"></p>

  <hr />

  <h2>Download File</h2>
  <input type="text" id="fileNameDownload" placeholder="Enter file name (e.g., test.txt)" />
  <button onclick="downloadFile()">Download</button>
  <p id="downloadStatus"></p>

  <script>
    const apiUrl = 'https://3s2sew1mjh.execute-api.eu-north-1.amazonaws.com/prod';

    async function uploadFile() {
      const fileInput = document.getElementById('fileInput');
      const status = document.getElementById('uploadStatus');
      if (!fileInput.files.length) {
        status.textContent = 'Please select a file.';
        return;
      }

      const file = fileInput.files[0];
      try {
        const response = await fetch(`${apiUrl}?fileName=${file.name}`, {
          method: 'POST',
          headers: {
            'Content-Type': file.type || 'text/plain',
          },
          body: file,
        });

        const result = await response.text();
        status.textContent = response.ok ? 'File uploaded successfully!' : `Error: ${result}`;
      } catch (error) {
        status.textContent = 'Upload failed: ' + error.message;
      }
    }

    function downloadFile() {
      const fileName = document.getElementById('fileNameDownload').value;
      const status = document.getElementById('downloadStatus');

      if (!fileName) {
        status.textContent = 'Please enter a file name.';
        return;
      }

      const link = document.createElement('a');
      link.href = `${apiUrl}?fileName=${encodeURIComponent(fileName)}`;
      link.download = fileName;
      link.click();

      status.textContent = 'Downloading...';
    }
  </script>
</body>
</html>
